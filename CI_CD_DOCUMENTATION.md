# TasteSmoke iOS CI/CD Documentation

## Обзор

Проект TasteSmoke использует GitHub Actions для автоматической сборки iOS приложения на Flutter с полной поддержкой Firebase и всех функций оригинального Android приложения.

## iOS Workflow

### Build TasteSmoke iOS App (`ios_build.yml`)
**Триггеры:** 
- Push в `main`, `develop`
- Pull Request в `main`
- Ручной запуск через workflow_dispatch
- Создание GitHub Release

**Результат:**
- IPA файл готовый для сайдлоадинга
- Автоматическая проверка Firebase конфигурации
- Поддержка demo-режима при отсутствии Firebase
- Артефакт сохраняется на 90 дней
- Автоматическое прикрепление к GitHub Releases

**Платформа:** macOS-14 (стабильная версия для iOS сборки)

## Системные требования

### CI/CD Requirements:
- **macOS-14** (GitHub Actions runner)
- **Flutter 3.35.2** (stable channel)
- **Xcode** (автоматически доступен на macOS runner)
- **Firebase iOS конфигурация** (опционально)

### Локальная разработка:
- **Windows 10/11** (для разработки)
- **Flutter 3.16.0+**
- **Visual Studio Code** или **Android Studio**
- **Chrome** (для веб-тестирования)

## Использование

### Автоматические сборки
1. **Разработка:** Push в `develop` → автоматическая сборка iOS
2. **Интеграция:** Pull Request в `main` → проверка сборки
3. **Релиз:** Создание Release → сборка + автоматическое прикрепление IPA

### Создание релиза
```bash
# Создать и запушить тег
git tag v1.2.0
git push origin v1.2.0

# Создать Release через GitHub UI
# IPA файл будет автоматически прикреплен
```

### Ручная сборка
1. Перейти в Actions на GitHub
2. Выбрать "Build TasteSmoke iOS App"
3. Нажать "Run workflow"
4. Выбрать ветку и запустить

## Скачивание и установка

### Скачивание IPA

#### Из Actions:
1. Открыть completed workflow run
2. Секция "Artifacts" → скачать `TasteSmoke-iOS-vX.X.X.zip`
3. Распаковать и найти `TasteSmoke-iOS.ipa`

#### Из Releases:
1. Перейти в Releases
2. Скачать `TasteSmoke-iOS.ipa` из Assets

### Установка на iPhone/iPad

#### Метод 1: AltStore (Рекомендуется для iOS 18.3+)
```bash
# Установка AltStore на Windows
1. Скачать AltStore с официального сайта
2. Установить iTunes и iCloud (если еще не установлены)
3. Подключить iPhone по USB
4. Запустить AltStore и следовать инструкциям
5. Перетащить IPA файл в AltStore
```

#### Метод 2: 3uTools
```bash
1. Скачать и установить 3uTools
2. Подключить iPhone по USB
3. Перейти в раздел "Apps"
4. Нажать "Install" и выбрать IPA файл
```

#### Метод 3: Sideloadly
```bash
1. Скачать Sideloadly
2. Подключить устройство
3. Ввести Apple ID (локально, не передается)
4. Выбрать IPA файл и установить
```

### Настройка доверия (iOS)

#### Для iOS 16+:
1. **Настройки** → **Основные** → **VPN и управление устройством**
2. **Профили разработчика** → найти ваш профиль
3. Нажать **Доверять [Имя разработчика]**
4. **Настройки** → **Конфиденциальность и безопасность** → **Режим разработчика**
5. Включить **Режим разработчика** и перезагрузить устройство

#### Для iOS 15 и ниже:
1. **Настройки** → **Основные** → **Профили и управление устройством**
2. Найти профиль и нажать **Доверять**

#### Альтернативный путь (iOS 18.3):
**Настройки** → **Основные** → **Об этом устройстве** → **Доверие сертификатов**

## Структура артефактов

```
TasteSmoke-iOS-vX.X.X.zip
├── TasteSmoke-iOS.ipa          # Готовый для установки
└── build-info.md               # Информация о сборке
```

## Время сборки

- **Полная сборка iOS:** 15-20 минут
- **Проверка кода:** 3-5 минут  
- **Создание IPA:** 2-3 минуты
- **Загрузка артефактов:** 1-2 минуты

## Firebase конфигурация

### Автоматическая проверка
Workflow автоматически проверяет наличие:
- `ios/Runner/GoogleService-Info.plist`
- Выводит соответствующие сообщения в логи

### Режимы работы
1. **С Firebase:** Полная функциональность с синхронизацией
2. **Demo режим:** Работа с моковыми данными при отсутствии Firebase

## Troubleshooting

### Частые проблемы

#### 1. Сборка не запускается
```bash
# Проверить права доступа к репозиторию
# Settings → Actions → General → Workflow permissions
```

#### 2. Firebase ошибки
```bash
# Приложение работает в demo режиме
# Добавить GoogleService-Info.plist для полной функциональности
```

#### 3. Установка не удается
```bash
# Проверить доверие сертификата
# Убедиться что включен режим разработчика (iOS 16+)
# Попробовать другой метод установки (AltStore/3uTools)
```

#### 4. Приложение не запускается
```bash
# Проверить логи в Xcode (если доступен Mac)
# Переустановить приложение
# Проверить совместимость с версией iOS
```

### Логи и отладка
- Проверить логи в конкретном workflow run
- Использовать `flutter doctor` для диагностики локально
- Проверить совместимость версий Flutter

## Мониторинг

- **Status Badge:** Можно добавить в README
- **Notifications:** Настроить в Settings → Notifications
- **Release автоматизация:** IPA автоматически прикрепляется к релизам

## Обновление workflow

При изменении конфигурации CI/CD:
1. Обновить `ios_build.yml`
2. Протестировать на ветке `develop`
3. Создать Pull Request в `main`
4. После слияния - workflow обновится автоматически

## Безопасность

- **Приватный репозиторий:** Рекомендуется для коммерческих проектов
- **Сертификаты:** IPA файлы не подписаны (требуют сайдлоадинг)
- **Firebase конфиг:** Не содержит секретных ключей (безопасно для публичных репо)
- **Apple ID:** Используется только локально в инструментах сайдлоадинга